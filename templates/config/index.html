<div class="layui-card">
    <div class="layui-card-body">
        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
                <li class="layui-this">基本设置</li>
                <li>环境设置</li>
                <li>采集设置</li>
                <li>翻译设置</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show layui-form">
                    {{.baseHtml}}
                    <div class="layui-form-item">
                        <label class="layui-form-label"></label>
                        <div class="layui-btn-group">
                            <button class="layui-btn" lay-submit lay-filter="submit-base">立即提交
                            </button>
                            <button class="layui-btn" data-event="reset" data-name="base" data-tip="Base 恢复出厂设置?">恢复默认
                            </button>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item layui-form">
                    {{.serverHtml}}
                    <div class="layui-form-item">
                        <label class="layui-form-label">root密码:</label>
                        <div class="layui-input-inline">
                            <input class="layui-input" value="{{.rootclient.Password}}" disabled>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label"></label>
                        <div class="layui-btn-group">
                            <button class="layui-btn" lay-submit lay-filter="submit-server">立即提交
                            </button>
                            <button class="layui-btn" data-event="reset" data-name="server" data-tip="Server 恢复出厂设置?">
                                恢复默认
                            </button>
                            <button class="layui-btn layui-btn-danger" data-event="reset" data-name="app"
                                    data-tip="抹去本程序所有数据?包括所建的网站等...">重置App
                            </button>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item layui-form">
                    {{.dataHtml}}
                    <div class="layui-form-item">
                        <label class="layui-form-label"></label>
                        <div class="layui-btn-group">
                            <button class="layui-btn" lay-submit lay-filter="submit-data">立即提交
                            </button>
                            <button class="layui-btn layui-btn-danger" data-event="reset" data-name="data"
                                    data-tip="清空所有已经采集的数据?不可恢复!">
                                清空采集数据
                            </button>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">
                    <div class="layui-fluid">
                        <div class="layui-row layui-col-space10">
                            <div class="layui-col-sm4">
                                <fieldset class="layui-elem-field layui-form">
                                    <legend>谷歌翻译</legend>
                                    {{.transGoogleHtml}}
                                </fieldset>
                            </div>
                            <div class="layui-col-sm4">
                                <fieldset class="layui-elem-field layui-form">
                                    <legend>百度翻译</legend>
                                    {{.transBaiduHtml}}
                                </fieldset>
                            </div>
                            <div class="layui-col-sm4">
                                <fieldset class="layui-elem-field layui-form">
                                    <legend>有道翻译</legend>
                                    {{.transYoudaoHtml}}
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-card-body">
        <button class="layui-btn layui-btn-primary" data-event="edit">在线编辑配置文件</button>
    </div>
</div>
<script src="/static/layui/layui.js"></script>
<script>
    layui.config({
        base: '/static/' //静态资源所在路径
    }).extend({
        index: 'lib/index', //主入口模块
        main: 'main'
    }).use(['index', 'form', 'main'], function () {
        var $ = layui.$,
            layer = layui.layer,
            main = layui.main,
            form = layui.form,
            url = {{.current_uri}};

        form.on('submit(submit-base)', function (obj) {
            main.req({
                url: url + '/base',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-server)', function (obj) {
            main.req({
                url: url + '/server',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-cache)', function (obj) {
            main.req({
                url: url + '/cache',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-data)', function (obj) {
            main.req({
                url: url + '/data',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-google)', function (obj) {
            main.req({
                url: url + '/google',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-baidu)', function (obj) {
            main.req({
                url: url + '/baidu',
                data: obj.field,
            });
            return false;
        });
        form.on('submit(submit-youdao)', function (obj) {
            main.req({
                url: url + '/youdao',
                data: obj.field,
            });
            return false;
        });
        $('.layui-btn[data-event]').on('click', function () {
            var othis = $(this);
            var event = othis.data('event');
            switch (event) {
                case 'reset':
                    var name = othis.data('name'),
                        tip = othis.data('tip');
                    if (name.length == 0) {
                        return false;
                    }
                    layer.confirm(tip, function (index) {
                        main.req({
                            url: url + '/reset',
                            data: {name: name},
                            index: index,
                            ending: function () {
                                document.location.reload();
                            }
                        });
                    });
                    break;
                case 'edit':
                    $.get('/file/editor', {'path': 'data/config.conf', 'hide': true}, function (html) {
                        main.popup({
                            title: '编辑文件',
                            content: html,
                        });
                    });
                    break;
            }
            return false;
        });
    });
</script>