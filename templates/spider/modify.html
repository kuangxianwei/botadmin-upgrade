<div class="layui-card">
    <div class="layui-card-body step-header"></div>
    <div class="layui-card-body step-content">
        <div>
            <div class="layui-form-item">
                <label class="layui-form-label">任务名称:</label>
                <div class="layui-input-block" lay-tips="任务名称必须由中文、数字、字母、下划线组成 唯一">
                    <input type="hidden" name="id" value="{{.obj.Id}}">
                    <input type="text" name="name" value="{{.obj.Name}}" class="layui-input" required lay-verify="name">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-row layui-col-space10">
                    <div class="layui-col-sm6">
                        <label class="layui-form-label">初始种子:</label>
                        <div class="layui-input-block" lay-tips="一行一条 如: https://www.nfivf.com">
                    <textarea name="seeds" class="layui-textarea" required
                              lay-verify="seeds">{{join .obj.Seeds "\n"}}</textarea>
                        </div>
                    </div>
                    <div class="layui-col-sm6">
                        <label class="layui-form-label">备注:</label>
                        <div class="layui-input-block">
                            <textarea name="note" class="layui-textarea">{{.obj.Note}}</textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-collapse" lay-accordion>
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title">翻译处理</h2>
                        <div class="layui-colla-content">
                            <div id="trans-items">
                                {{range $i,$v:=.obj.Trans -}}
                                    <div class="layui-form-item">
                                        <div class="layui-input-inline">
                                            <input type="checkbox" name="trans.enabled.{{$i}}" lay-skin="switch"
                                                   lay-text="启用|关闭" checked>
                                        </div>
                                        <div class="layui-inline">
                                            <label class="layui-form-label-col">引擎:</label>
                                        </div>
                                        <div class="layui-inline">
                                            <select name="trans.engine.{{$i}}" lay-filter="trans.engine.{{$i}}">
                                                {{range $kk,$vv:=$.adapters}}
                                                    <option value="{{$kk}}"{{if eq $kk $v.Engine}} selected{{end}}>{{$vv.Alias}}</option>
                                                {{end}}
                                            </select>
                                        </div>
                                        <div class="layui-inline">
                                            <select name="trans.source.{{$i}}" lay-search>
                                                <option value="{{$v.Source}}" selected>{{$v.Source}}</option>
                                            </select>
                                        </div>
                                        <div class="layui-inline">
                                            <label class="layui-form-label-col" style="color: #009688;">
                                                <i class="layui-icon layui-icon-spread-left"></i>
                                            </label>
                                        </div>
                                        <div class="layui-inline">
                                            <select name="trans.target.{{$i}}" lay-search>
                                                <option value="{{$v.Target}}">{{$v.Target}}</option>
                                            </select>
                                        </div>
                                        <div class="layui-inline" lay-tips="删除该项">
                                            <button class="layui-btn layui-btn-primary" style="border:none;color: red"
                                                    lay-event="del-trans">
                                                <i class="layui-icon layui-icon-delete"></i>
                                            </button>
                                        </div>
                                    </div>
                                {{end -}}
                            </div>
                            <button class="layui-btn layui-btn-sm layui-btn-radius" lay-event="add-trans"
                                    style="margin: 10px 40px" lay-tips="新增一次翻译 则多翻译一次 例如：中文 -> 泰文 -> 英文 -> 中文 这样就翻译了3次">
                                <i class="layui-icon layui-icon-add-circle"></i>新增翻译引擎
                            </button>
                        </div>
                    </div>
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title">高级选项</h2>
                        <div class="layui-colla-content">
                            <div class="layui-form-item">
                                <div class="layui-inline" style="width: 48%"
                                     lay-tips="格式 key1=value1; key2=value2; 或者一行一条">
                                    <label class="layui-form-label">cookies:</label>
                                    <div class="layui-input-block">
                                        <textarea name="cookies" class="layui-textarea">{{.obj.Cookies}}</textarea>
                                    </div>
                                </div>
                                <div class="layui-inline" style="width: 48%" lay-tips="允许的域名一行一条">
                                    <label class="layui-form-label">allowDomains:</label>
                                    <div class="layui-input-block">
                                        <textarea name="allow_domains"
                                                  class="layui-textarea">{{.obj.AllowDomains}}</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline" style="width: 31%"
                                     lay-tips="采集间隔 单位为秒 10-20 随机最少10秒最多20秒">
                                    <label class="layui-form-label">Delay:</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="delay" class="layui-input" value="{{.obj.Delay}}">
                                    </div>
                                </div>
                                <div class="layui-inline" style="width: 31%" lay-tips="指定字符集">
                                    <label class="layui-form-label">字符集:</label>
                                    <div class="layui-input-block">
                                        <select name="charset">
                                            <option value="">自动</option>
                                            <option value="utf-8"{{if eq .obj.Charset "utf-8"}} selected{{end}}>UTF-8
                                            </option>
                                            <option value="gbk"{{if eq .obj.Charset "gbk"}} selected{{end}}>GBK</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="width: 31%" lay-tips="内容解码">
                                    <label class="layui-form-label">解码:</label>
                                    <div class="layui-input-block">
                                        <select name="decode">
                                            <option>无</option>
                                            {{range .decodes -}}
                                                <option value="{{.}}"{{if eq $.obj.Decode . }} selected{{end}}>{{.}}</option>
                                            {{end -}}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-col-md10 layui-col-md-offset1">
                <button class="layui-btn layui-btn-sm layui-btn-radius"
                        style="margin-bottom: -65px;margin-left: -35px"
                        lay-event="addListRule" lay-tips="点击无限添加列表规则">+
                </button>
                <div class="layui-tab layui-tab-card" lay-filter="step-list" lay-allowclose="true">
                    <ul class="layui-tab-title">
                        {{range $i,$v:= .obj.List -}}
                            <li lay-id="{{$i}}"{{if eq $i 0 }} class="layui-this"{{end}}>Rule-{{increment $i}}</li>
                        {{end -}}
                    </ul>
                    <div class="layui-tab-content">
                        {{range $i,$v:= .obj.List -}}
                            <div class="layui-tab-item{{if eq $i 0 }} layui-show{{end}}">
                                <div class="layui-collapse" lay-accordion>
                                    <div class="layui-colla-item">
                                        <h2 class="layui-colla-title">列表采集</h2>
                                        <div class="layui-colla-content layui-show">
                                            <fieldset class="layui-elem-field layui-field-title">
                                                <legend>获取</legend>
                                            </fieldset>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <label class="layui-form-label-col">指定范围:</label>
                                                </div>
                                                <div class="layui-inline">
                                                    <div class="layui-input-inline">
                                                        <input type="text" name="list.limit.{{$i}}" value="{{$v.Limit}}"
                                                               class="layui-input">
                                                    </div>
                                                    <div class="layui-form-mid layui-word-aux">指定获取范围 为空则不指定 &lt;html[^&gt;]*&gt;([\s\S]*?)&lt;/html&gt;
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="parse-method">
                                                    <div class="layui-inline">
                                                        <label class="layui-form-label-col">DOM解析:</label>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="一行一条规则，逐行匹配到则终止匹配">
                                                        <textarea class="layui-textarea"
                                                                  name="list.dom.{{$i}}">{{$v.Dom}}</textarea>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="选择dom取值方法">
                                                        <div class="layui-input-inline" style="width: 80px">
                                                            <select name="list.method.{{$i}}">
                                                                <option value="attr"{{if eq $v.Method "attr"}}
                                                                selected{{end}}>Attr
                                                                </option>
                                                                <option value="text"{{if eq $v.Method "text"}}
                                                                selected{{end}}>Text
                                                                </option>
                                                                <option value="html"{{if eq $v.Method "html"}}
                                                                selected{{end}}>Html
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="属性名称 默认为 href">
                                                        <input type="text" name="list.attr_name.{{$i}}"
                                                               value="{{$v.AttrName}}" class="layui-input">
                                                    </div>
                                                    <div class="layui-inline">
                                                        <button class="layui-btn layui-btn-radius" parse-method>转为正则解析
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="parse-method layui-hide">
                                                    <div class="layui-inline">
                                                        <label class="layui-form-label-col">正则解析:</label>
                                                    </div>
                                                    <div class="layui-inline" style="width: 55%"
                                                         lay-tips="一行一条规则，逐行匹配到则终止匹配">
                                                        <textarea class="layui-textarea"
                                                                  name="list.reg.{{$i}}">{{$v.Reg}}</textarea>
                                                    </div>
                                                    <div class="layui-inline">
                                                        <button class="layui-btn layui-btn-radius" parse-method>
                                                            转为DOM解析
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <fieldset class="layui-elem-field layui-field-title">
                                                <legend>过滤</legend>
                                            </fieldset>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label"
                                                       lay-tips="例如:只匹配以/index.html结尾的数据 /index\.html$">正则匹配:</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="list.match.{{$i}}" value="{{$v.Match}}"
                                                           class="layui-input">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <div class="layui-form-mid layui-word-aux">原词 一行一条</div>
                                                    <textarea name="list.olds.{{$i}}"
                                                              class="layui-textarea">{{join $v.Olds "\n"}}</textarea>
                                                </div>
                                                <div class="layui-inline">
                                                    <div class="layui-form-mid layui-word-aux">替换成 对应原词一行一条</div>
                                                    <textarea name="list.news.{{$i}}"
                                                              class="layui-textarea">{{join $v.News "\n"}}</textarea>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <input type="checkbox" name="list.trim_html.{{$i}}"
                                                           title="过滤html标签"{{if $v.TrimHtml}} checked{{end}}>
                                                </div>
                                                <div class="layui-inline">
                                                    <input type="checkbox" name="list.reg_enabled.{{$i}}"
                                                           title="启用正则过滤"{{if $v.RegEnabled}} checked{{end}}>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="layui-colla-item">
                                        <h2 class="layui-colla-title">分页采集</h2>
                                        <div class="layui-colla-content">
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">开启分页:</label>
                                                <div class="layui-input-inline">
                                                    <input type="checkbox" name="list.page.enabled.{{$i}}"
                                                           lay-skin="switch"
                                                           lay-text="开启|关闭"{{if $v.Page.Enabled}} checked{{end}}>
                                                </div>
                                            </div>
                                            <fieldset class="layui-elem-field layui-field-title">
                                                <legend>获取</legend>
                                            </fieldset>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <label class="layui-form-label-col">指定范围:</label>
                                                </div>
                                                <div class="layui-inline">
                                                    <div class="layui-input-inline">
                                                        <input type="text" name="list.page.limit.{{$i}}"
                                                               value="{{$v.Page.Limit}}" class="layui-input">
                                                    </div>
                                                    <div class="layui-form-mid layui-word-aux">指定获取范围 为空则不指定 &lt;html[^&gt;]*&gt;([\s\S]*?)&lt;/html&gt;
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="parse-method">
                                                    <div class="layui-inline">
                                                        <label class="layui-form-label-col">DOM解析:</label>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="一行一条规则，逐行匹配到则终止匹配">
                                                        <textarea class="layui-textarea"
                                                                  name="list.page.dom.{{$i}}">{{$v.Page.Dom}}</textarea>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="选择dom取值方法">
                                                        <div class="layui-input-inline" style="width: 80px">
                                                            <select name="list.page.method.{{$i}}">
                                                                <option value="attr"{{if eq $v.Page.Method "attr"}}
                                                                selected{{end}}>Attr
                                                                </option>
                                                                <option value="text"{{if eq $v.Page.Method "text"}}
                                                                selected{{end}}>Text
                                                                </option>
                                                                <option value="html"{{if eq $v.Page.Method "html"}}
                                                                selected{{end}}>Html
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="layui-inline" lay-tips="属性名称 默认为 href">
                                                        <input type="text" name="list.page.attr_name.{{$i}}"
                                                               value="{{$v.Page.AttrName}}"
                                                               class="layui-input">
                                                    </div>
                                                    <div class="layui-inline">
                                                        <button class="layui-btn layui-btn-radius" parse-method>转为正则解析
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="parse-method layui-hide">
                                                    <div class="layui-inline">
                                                        <label class="layui-form-label-col">正则解析:</label>
                                                    </div>
                                                    <div class="layui-inline" style="width: 55%"
                                                         lay-tips="一行一条规则，逐行匹配到则终止匹配">
                                                        <textarea class="layui-textarea"
                                                                  name="list.page.reg.{{$i}}">{{$v.Page.Reg}}</textarea>
                                                    </div>
                                                    <div class="layui-inline">
                                                        <button class="layui-btn layui-btn-radius" parse-method>
                                                            转为DOM解析
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <fieldset class="layui-elem-field layui-field-title">
                                                <legend>过滤</legend>
                                            </fieldset>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label"
                                                       lay-tips="例如:只匹配以/index.html结尾的数据 /index\.html$">正则匹配:</label>
                                                <div class="layui-input-block">
                                                    <input type="text" name="list.page.match.{{$i}}"
                                                           value="{{$v.Page.Match}}" class="layui-input">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <div class="layui-form-mid layui-word-aux">原词 一行一条</div>
                                                    <textarea name="list.page.olds.{{$i}}"
                                                              class="layui-textarea">{{join $v.Page.Olds "\n"}}</textarea>
                                                </div>
                                                <div class="layui-inline">
                                                    <div class="layui-form-mid layui-word-aux">替换成 对应原词一行一条</div>
                                                    <textarea name="list.page.news.{{$i}}"
                                                              class="layui-textarea">{{join $v.Page.News "\n"}}</textarea>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <input type="checkbox" name="list.page.trim_html.{{$i}}"
                                                           title="过滤html标签"{{if $v.Page.TrimHtml}} checked{{end}}>
                                                </div>
                                                <div class="layui-inline">
                                                    <input type="checkbox" name="list.page.reg_enabled.{{$i}}"
                                                           title="启用正则过滤"{{if $v.Page.RegEnabled}} checked{{end}}>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {{end -}}
                    </div>
                </div>
                <div class="layui-card-body">
                    <button class="layui-hide" lay-submit lay-filter="testList"></button>
                    <button class="layui-btn" data-event="testList">测试采集</button>
                </div>
            </div>
        </div>
        <div class="layui-row">
            <div class="layui-col-md10 layui-col-md-offset1">
                <button class="layui-btn layui-btn-sm layui-btn-radius"
                        style="margin-bottom: -65px;margin-left: -35px"
                        lay-event="addDetailRule" lay-tips="点击无限添加规则">+
                </button>
                <div class="layui-tab layui-tab-card" lay-filter="step-detail" lay-allowclose="true">
                    <ul class="layui-tab-title">{{.tabDetailTitle}}</ul>
                    <div class="layui-tab-content">{{.tabDetailContent}}</div>
                </div>
                <div class="layui-card-body">
                    <button class="layui-hide" lay-submit lay-filter="testDetail"></button>
                    <button class="layui-btn" data-event="testDetail">测试采集</button>
                </div>
            </div>
        </div>
        <div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">绑定网站:</label>
                    <div class="layui-input-block">
                        <select name="site_id" lay-filter="site_id" lay-search>
                            <option value="">搜索...</option>
                            {{range .sites -}}
                                <option value="{{.Id}}"{{if eq .Id $.obj.SiteId}} selected{{end}}>{{.Vhost}}</option>
                            {{end -}}
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">绑定栏目:</label>
                    <div class="layui-input-block" lay-filter="class_id">
                        <select name="class_id" lay-search>
                            <option value="">搜索...</option>
                            {{if gt .obj.ClassId 0 -}}
                                <option value="{{$.obj.ClassId}}" selected>{{$.obj.ClassId}}</option>
                            {{end -}}
                        </select>
                    </div>
                </div>
            </div>
            <fieldset class="layui-elem-field">
                <legend>定时发布</legend>
                <div class="layui-form-item">
                    <label class="layui-form-label">启用</label>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="cron_enabled" lay-skin="switch" lay-text="是|否"
                                {{if .obj.CronEnabled}} checked{{end}}>
                    </div>
                    <div class="layui-form-mid layui-word-aux">是否启用定时发布</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">分:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="minute" value="{{.obj.Minute}}"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">0-59 *-,</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">时:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="hour" value="{{.obj.Hour}}"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">0-23 *-,</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">天:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="day" value="{{.obj.Day}}"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">1-31 *-,</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">月:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="month" value="{{.obj.Month}}"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">1-12 *-,</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">周:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="week" value="{{.obj.Week}}"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">0-6 *-,</div>
                </div>
            </fieldset>
        </div>
    </div>
</div>
{{template "common" .}}

